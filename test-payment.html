<!DOCTYPE html>
<html>
<head>
    <title>Test PhonePe Payment</title>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-functions-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .container { background: #f5f5f5; padding: 20px; border-radius: 8px; }
        .form-group { margin-bottom: 15px; }
        button { padding: 10px 20px; background: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #3367d6; }
        .instructions { margin-top: 30px; background: #fff; padding: 15px; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>Test PhonePe Payment</h1>
    <div class="container">
        <div class="form-group">
            <label>Amount (INR): </label>
            <input type="number" id="amount" value="100" min="1">
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="isPartialCOD"> Partial COD (â‚¹100 only)
            </label>
        </div>
        <button onclick="testPayment()">Test Payment</button>
    </div>

    <div class="instructions">
        <h3>Testing Instructions:</h3>
        <ol>
            <li>Click "Test Payment" button</li>
            <li>You'll be redirected to PhonePe payment page</li>
            <li>Use test credentials:</n>               - UPI ID: success@phonepe (always succeeds)
               - Or test card: 4111 1111 1111 1111 (any future date, any CVV)</li>
            <li>After payment, you'll be redirected back to status page</li>
        </ol>
    </div>

    <script>
        // TODO: Replace with your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAZGH8rJGdSyBFMAi0C83hmiV7MVqfLdz4",
            authDomain: "aziz-phone-hub.firebaseapp.com",
            projectId: "aziz-phone-hub",
            // Add other config if needed
        };
        
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const functions = firebase.functions(app);
        
        // For local testing with emulator
        if (window.location.hostname === "localhost") {
            functions.useEmulator("localhost", 5001); // Matches the port in firebase.json
            console.log('Using local emulator on port 5001');
        }

        async function testPayment() {
            const button = document.querySelector('button');
            button.disabled = true;
            button.textContent = 'Processing...';
            
            try {
                const amount = document.getElementById('amount').value || 100;
                const isPartialCOD = document.getElementById('isPartialCOD').checked;
                
                const initiatePayment = functions.httpsCallable('initiatePayment');
                const result = await initiatePayment({
                    amount: parseInt(amount),
                    orderId: 'TEST' + Date.now(),
                    mobileNumber: '9876543210',
                    email: 'test@example.com',
                    isPartialCOD: isPartialCOD
                });
                
                console.log('Redirecting to:', result.data.paymentUrl);
                window.location.href = result.data.paymentUrl;
            } catch (error) {
                console.error('Payment error:', error);
                alert('Payment failed: ' + error.message);
                button.disabled = false;
                button.textContent = 'Try Again';
            }
        }
    </script>
</body>
</html>
