<!DOCTYPE html>
<html>
<head>
    <title>Payment Status</title>
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-functions-compat.js"></script>
    <script>
        // TODO: Replace with your actual Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAZGH8rJGdSyBFMAi0C83hmiV7MVqfLdz4",
            authDomain: "aziz-phone-hub.firebaseapp.com",
            projectId: "aziz-phone-hub",
        };
        const app = firebase.initializeApp(firebaseConfig);
        const functions = firebase.functions(app);
        
        // For local testing with emulator
        if (window.location.hostname === "localhost") {
            functions.useEmulator("localhost", 5001); // Matches the port in firebase.json
            console.log('Using local emulator on port 5001');
        }

        async function checkStatus(orderId) {
            try {
                const checkPaymentStatus = functions.httpsCallable('checkPaymentStatus');
                const result = await checkPaymentStatus({ orderId });
                document.getElementById('status').textContent =
                    'Payment Status: ' + result.data.status + (result.data.orderStatus ? ' (' + result.data.orderStatus + ')' : '');
            } catch (e) {
                document.getElementById('status').textContent = 'Error checking payment status: ' + e.message;
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('orderId');
            document.getElementById('orderId').textContent = orderId || 'N/A';
            if (orderId) checkStatus(orderId);
        });
    </script>
</head>
<body>
    <h1>Payment Status</h1>
    <p>Order ID: <span id="orderId"></span></p>
    <div id="status">Processing your payment...</div>
</body>
</html>
